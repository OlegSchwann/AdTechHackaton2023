# SalezOn

## Суть проги и её назначение
Цель этой программы - предоставление скидочных промо-кодов простым смертным. Вход для них - бесплатный, нужно только скачать приложуху и ввести базвоые данные (имя и номер телефона), ну и исполнять условия его использования.
Помимо этого, в прогу будет вшит функционал бронирования столов, для чего собственно и нужны будут имена и номера телефонов и заказ на дайн ин и тейкавей.
Для других типов бизнеса (кроме хореки) можем потом допилить доп функционал.
Монетизация будет идти за счёт привода клиентов в заведения.
В зависимости от заведения, за каждого приведенного клиента, нам будет идти фикса от 1 евро до бесконечности.
Грубо говоря, если мы привели клиента на кофе, то нам заведение заплатит 1 евро, а если и через нашу прогу продали пентхаус в дель маре, то это уже совсем другие деньги.
Бот будет разделен на 3 части - клиентам, партнерам и нам.
В последующих частях я опишу функционал каждого из них.

## Интерфейс для клиентов
#### Получение промо-кода
Для получения промо-кода, человек должен ввести название организации в поиске или выбрать из менюшки.
То есть, грубо говоря, он может вбить fatboyshop и получить купон на скидку в, представим, 10% на покупки в магазине одежды.
Помимо этого, у клиента должна быть возможность выбрать из меню категорий.
2.1. Средства поиска
2.1.1.Категории
Меню должно быть из кнопок и делиться на категории исходя из услуг. Например, там будет
такая система:
a. All shops
b. Eating out
i. All
ii. Coffee
iii. Dining
iv. Sweets
c. Clothes
i. All
ii. Casual
iii. Fashion
iv.
d. Entertainment
e. Beautyf.
For Business
Ну и так далее.
По ходу развития, категории будут дополняться, могут появляться субкатегории.
Механика переходов такая: Категории->Субкатегории(если есть)->Партнеры

### 2.1.2.Поиск
Поиск будет делаться по названиям или тегам.
Человек просто вбивает название или тег в строке поиска и получает варианты.
Если выбирается поиск по тегам, то человеку просто после нажатия выдаются результаты его запроса из базы тегов.
Наверное, на поисковик нужно сделать требования по минимальному количеству символов или что-то такое, чтобы прога не выдавала сразу миллион мест.
Ну и плюс пруфинг, для кривопальцовых (можно как у гугла «может быть вы имели блабла»).
### 2.1.3. Феворитс
Здесь будут храниться любимые кодики.
При нажатии на компанию все идет также как и в пункте 2.2.
2.1.4.Суперскидоны щас
При жмяке на нее выдается список компаний (как и в списке категории), только еще пишется максимально возможная скидка, грубо говоря:
Bilbo Bar- 90%
После жмяка все идет как в пункте 2.2.
### 2.1.5.Фидбек
При жмяке, выдается окошко для текста и прога будет это все форвардить в нашу версию.
### 2.2. Получение кода
После того, как человек выбрал компанию, он на нее тыкает, ему выплывает меню из
вариантов скидок на выбор и доп функции (забронировать стол, заказать наперед, купить что-
то напрямую и так далее в зависимости от места).
После выбора скидки, вылезает подтверждение о том, что скидка получена, ваш промокод
1488Cy и что теперь у вас 3 из 5 неиспользованных кодов, для получении информации об
использовании промок, ткните кнопку «дайте инфы» + кнопка «Ту Фейворитс».
Под этим же промокодом должна быть кнопка отменить, на случай непредумышленного тыка
не туда, которая будет держаться в течении двух минут.
### 2.3. Хранение кода и лимитыПосле выбора промокода, он отправляется в хранилище промок. Его максимальный лимит 5
штук. Пользователь может попасть в этот раздел кликнув на советующую кнопку.
Также, клиент не может взять больше одной промки от одного партнера. Он может поменять
её на другую. Для этого в хранилище под каждым кодом должна быть кнопка «поменять» и
после тыка на неё выйдут все коды от определенного партнера, после тыка на который код
заменяется.
В том случае, если человек берет 5й промо-код при 4х неиспользованных, бот должен
предупредить клиента о том, что если он не использует хотя бы один код, то бот не сможет
выдать ему еще один (здесь перед взятием промки человек должен тыкнуть на кнопку «понял
дай мне скидон»). Если у клиента уже накопилось 5 неиспользованных кодов и заказывает еще
один, прога должна выдать, что клиент достиг максимума неиспользованных кодов и ему
нужно использовать хотя бы один, чтобы заказать еще.
Через 2 недели после заказа кода, человеку будет приходить вопрос о том, что использовал ли
он его. Он может ответить да или нет. Если он отвечает да, то его промокод удаляется и, а нам
приходит соответствующее оповещение.
### 2.4. Промоутирование
Раз в какое-либо время (тут решим еще, скорее всего, один или пару раз в день), приложуха
должна направлять клиентам рекламные объявления о том или ином партнере. Он будет
выбираться исходя из нашей заинтересованности (либо они изначально платят больше, либо
проплатили рекламную кампанию) и выборов клиента в пердыдущих промках.
### 3. Интерфейс для партнеров
### 3.1. Суть
Каждому партнеру должен быть выдан отдельный интерфейс, где он будет получать
извещения о том, что кто-либо взял промо-код на их услуги, подтверждать использование
промокода.
### 3.2. Извещение о получении промо-кода
Как только какой-либо клиент заказал промо-код, партнер должен получить извещение об
этом. Он не должен получать уведомления о том, что были взяты промо-коды других
партнеров, только его. Там будет «[имя] только что запросил ваш промокод на [предложение].
Для его авторизации, либо нажмите на кнопку внизу или предоставьте клиенту
соответствующий QR код»
### 3.3. Авторизация промки
### 3.3.1.Через само приложение
У партнеров должна быть страничка с активными промокодами, там рядом можно разместить
кнопку для использования кода.
### 3.3.2.QR кодТакже, партнерам должен быть предоставлен их qr. Он будет являться универсальным ключом
для всех промок от партнера. Базово представляется, что он будет находиться у кассы, чтобы
сам юзер его сканил.
### 3.4. Промо акции
Партнеры могут заказать у нас промо-акцию.
### 3.4.1.Простая промка
По жмяку на неё, партнеру выдается сообщение, что братан, что ты хочешь продвинуть, само
место или отдельный промокод, он выбирает, если отдельная промка, то выбирает и её, потом
указывает срок промоушена.
По факту, это будет таргет внутри приложухи.
### 3.4.2.Суперскидон
Механика та же, будет выводиться реклама, но его предложение ещё попадет и во вкладку
суперскидонов.
Для реализации этого, партнер жмякает на кнопку, вводит описание и срок суперскидона, мы
это дело рассматриваем и если ок, то одобряем и запускаем.
### 3.5. Менеджер предложений
После жмяка партнер видит свои промки, которые может включать и отключать, а также
добавлять новые.
### 4. Интерфейс для никого, только для нас
### 4.1. Зачем он нам?
В наш интерфейс нам должны приходить все значимые моменты - клиент взял купон, партнер одобрил купон, нейтрал захотел дружить, партнер запросил промо-акцию.
### 4.2. Статистика
Должна быть возможность выводить следующую статистику:
- Использование услуги:
  - Кол-во взятых промо-кодов для того или иного партнера;
  - Общее количество пользователей и взятых промо-кодов;
- И иная вытекающая из этого статистика:
  - Наиболее популярные категории
  - Среднее количество людей в день
- Деньги:
- Кол-во одобренных партнерами промо-кодов, разбитые по категориям
процент, фикс и бесплатно;
oКоличество партеров, также разбитое по вышеуказанным категориям;5. Рефералочка
Это стоит учитывать при автоматическом подсчете бабала. Прога должна нам выдавать
сколько какой партнер нам должен (с учетом рефералки) и сколько кому мы должны исходя из
того кого этот реферал привел.
### 5.1. По партнерам
Суть рефералки - награда лица за привод партнеров. Реферал будет получать какой-то процент (высчитаем) от выручки с этого партнера.
Для реализации этого момента нужно в информацию о партнере добавить его реферала (если имеется), если приводит кто-то из нас, то строчка реферала будет пустой.
Автоматизации здесь не будет, так как каждый партнер должен быть первоначально одобрен нами, так что просто вручную будем вносить, что с партнером договорился условный Васян.
### 5.2. По клиентам
Суть рефералки - награда лица за привод клиентов. Для реализации нужно:
- QR код для кажного из агентов (будь то партнер или физ лицо) + просто ссылка, если QR будет в данном случае менее предпочтителен.
- Инфа о клиенте должна содержать его реферала.

Бонусы будут либо процент с клиента, либо, если привел партнер, бесплатное использование кодов от этого клиента для этого партнера, то есть если Ред Кафе приведет нам 500 человек, то со всех этих 500 человек Ред не будет нам платить нифига.
### 6. Данные для хранения
### 6.1. Клиенты
На клиентов, помимо всего прочего, нужного для функционирования бота, у нас должо храниться:
- Имя
- Телефон
- Скидок взято всего и за месяц - для возможных плюх за активное использование
- Кто привел - это для возможной рефералки (подумаем о введении кода партнера, ну или можно тупо при запуске чтобы бот спрашивал, что если вас кто-то привел, то напиши его ник в телеге, ну или можно через qr)- рефералом может быть как любое физ лицо, так и партнер
- Предпочтения (места с какими тегами чаще всего юзал)
### 6.2. Партнеры
На клиентов, помимо всего прочего, нужного для функционирования бота, у нас должо
храниться:
- Наименование
- Локация
- Количество запрошенных кодов
- Количество подтверждений об использовании (клиент)
- Количеств подтверждений об использовании (партнер)
- Кто привел
### 6.3. Общие сведения
Следующие данные:
- Количество пользователей
- Количество активных пользователей с больше 10 использований в месяц
- Количество партнеров

---

Поток мысли и рабочие моменты:  
Что делать?  
Backend для сервиса Кости.  
База данных и или API.  
Упор на хакатонность, стоит ли PosgreSQL добавлять? Кажется достаточно GET / PUT json'а.  
Описать сущности, вычленив из описания сверху и интерфейса.  


Из интерфейса:
Сущности:
  Promotion: Рекламный купон
    id купона
    id партнёра, создавшего купон
    id категории
    Заголовок
    Описание
    URL картинки
```postgresql
create table if not exists promotion(
    id int primary key not null,
    partner_id int not null references partner(id),
    category_id text not null references category(id),
    title text not null,
    description text not null
);
```
  Action: Факт что купон взят + факт что купон отканирован в ресторане
    тип действия
    Пользователь
    id купона
```postgresql
create table if not exists action(
    id int primary key not null,
    "type" text not null check (type in ('taken', 'expended')),
    user_id int not null references "user"(id),
    promotion_id int not null references promotion(id)
);
```
  Category: Категории купона
    id как 'упрощённое_имя'
    Имя категории
```postgresql
create table if not exists category(
    id text primary key not null,
    name text not null
);
```
  Пользователь
    имя
    телефон
    почта
```postgresql
create table if not exists "user"(
    id int primary key not null,
    mail text,
    phone_number text             
);
```
  Партнёр
    Заголовок
    Описание
    URL картинки
    Координаты ресторана
    Уровень цен 1-5
```postgresql
create table if not exists partner(
    id int primary key not null,
    headline text not null,
    description text not null,
    location point not null,
    price_level smallint check ( price_level between 1 and 5)
);
```
Картинки
  id патнёра или рекламного предложения
  url
  blob
```postgresql
create table if not exists headline_banner(
    url text primary key,
    partner_id int null references partner(id),
    action_id int null references promotion(id),
    image bytea not null
);
```

Запуск базы данных:
```shell
docker run --name ad-tech-hackaton-2023-postgres --publish=5432:5432 --env POSTGRES_PASSWORD=mysecretpassword -d postgres;
```

Запуск приложения:
```shell
export LISTEN=:8080;
export POSTGRESQL='host=localhost port=5432 user=postgres password=mysecretpassword dbname=postgres sslmode=disable';
go run main.go
```

Проверка запуска:
```shell
curl --silent 'http://localhost:8080/healthcheck';

curl --silent 'http://localhost:8080/categories';

curl --silent 'http://localhost:8080/categories?parent=1';
```
